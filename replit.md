# TechStore - Tienda de Tecnología

## Overview
TechStore is a modern, professional online technology store built with ASP.NET Core 8.0 Blazor Server. It enables users to browse, customize, and purchase tech products, including hardware (laptops, PCs, monitors), software (licenses, office suites), and IT services (technical support, custom development). The project aims to demonstrate a fully functional e-commerce platform with robust authentication, an interactive product catalog, product customization, a shopping cart, and an order management system, all within a modern UI/UX design.

## User Preferences
I prefer detailed explanations.
Do not make changes to the folder `Z`.
Do not make changes to the file `Y`.

## System Architecture

### UI/UX Decisions
The application features a modern, professional design with a dark theme utilizing cyan and black gradients. It employs the Inter typeface, smooth animations, and fluid transitions. The interface is responsive and optimized for various devices, incorporating hover effects and interactive states. Key design elements include a professionally styled navbar with animated elements, a shopping cart with visual feedback, and a user menu with a smooth dropdown animation.

### Technical Implementations
- **Authentication System**: Full login and registration with **BCrypt password hashing (workFactor: 12)** for enhanced security, email/password validation, user profiles with avatar support, secure password change, and persistent sessions. Orders are linked to user accounts, and routes like checkout and "My Orders" require authentication.
- **Interactive Catalog**: Product display with high-quality images, dynamic filters, **real-time search functionality**, wishlist/favorites integration, and detailed product descriptions.
- **Product Customization**: A modal system allows users to customize products with additional specifications (e.g., RAM, SSD upgrades, extended warranties), with real-time price calculation based on selections.
- **Shopping Cart**: Enhanced cart management with **CarritoService** including quantity modification, item removal, automatic total calculation, and **floating cart widget** with real-time counter. The cart works without login, but checkout requires authentication for order placement.
- **Wishlist/Favorites**: Users can save favorite products to their account with database persistence. The wishlist is accessible from the user menu and shows all favorited items with quick access to product details.
- **Order System**: Checkout form with data validation, customer information capture, and a complete order history per user, including detailed customized specifications for past orders with **status tracking** (Pendiente, EnProceso, Enviado, Entregado, Cancelado).
- **WhatsApp Integration**: After successful checkout, the system automatically redirects to WhatsApp (number: 3003895839) with a pre-formatted message containing complete order details (customer info, products, specifications, quantities, and totals). The message is generated by loading product and specification data from the database to ensure accuracy regardless of session state.
- **User Profile**: Enhanced profile page with **avatar support**, user statistics (total orders, completed orders, favorite products count), view and edit personal information including **city and country**, saved shipping address, contact number, and secure password changes. Profile displays complete order history with detailed information.

## Recent Implementation Details (November 2025)

### Sistema de Autenticación Mejorado (24 de Noviembre 2025)

Se ha implementado un sistema de autenticación robusto y profesional con las siguientes mejoras:

#### 1. **Autenticación Basada en Estado del Servidor**
- ✅ Sistema de autenticación compatible con Blazor Server
- ✅ Gestión de estado del usuario en el servidor durante la sesión activa
- ✅ Sin dependencia de cookies HTTP (compatible con componentes interactivos de Blazor)
- ✅ Estado persistente durante la conexión WebSocket de Blazor

#### 2. **Validaciones Robustas**
- ✅ **DataAnnotations** en todos los modelos (Login, Registro, Perfil)
- ✅ Validación de formato de email
- ✅ Contraseñas seguras: mínimo 8 caracteres, mayúscula, minúscula y número
- ✅ Mensajes de error personalizados en español
- ✅ ValidationSummary para mostrar todos los errores

#### 3. **Seguridad Mejorada**
- ✅ **BCrypt** con workFactor 12 para hashing de contraseñas
- ✅ Validación de email con `System.Net.Mail.MailAddress`
- ✅ Validación de contraseñas seguras (mayúsculas, minúsculas, números)
- ✅ Emails almacenados en minúsculas para evitar duplicados
- ✅ Verificación segura de contraseñas con BCrypt.Verify

#### 4. **Diseño Profesional**
- ✅ Nuevo archivo `auth.css` con estilos dedicados
- ✅ Gradientes y animaciones suaves
- ✅ Iconos animados (candado, cohete)
- ✅ Feedback visual con mensajes de éxito/error animados
- ✅ Spinner de carga durante procesamiento
- ✅ Responsive design para móviles
- ✅ Efectos de hover y transiciones fluidas

#### 5. **Mejoras UX**
- ✅ Redirección automática si el usuario ya está autenticado
- ✅ Mensajes de éxito/error con animaciones (slide-in, shake)
- ✅ Autocomplete habilitado en campos de formulario
- ✅ Placeholders descriptivos
- ✅ Indicadores de características del sistema (seguridad, velocidad, etc.)

#### 6. **Páginas Actualizadas**
- ✅ **Login.razor**: Diseño moderno con validaciones en tiempo real
- ✅ **Register.razor**: Formulario en dos columnas con hints de contraseña
- ✅ **Perfil.razor**: Validaciones DataAnnotations con persistencia en BD
- ✅ **MainLayout.razor**: Inicialización automática del usuario desde cookies

#### 7. **Flujo de Autenticación Completo**
1. Usuario accede a `/login` o `/register`
2. Si ya está autenticado, redirige automáticamente a `/`
3. Completa el formulario con validaciones en tiempo real
4. Al enviar, el sistema valida en el servidor (BCrypt para contraseñas)
5. Si es exitoso, almacena el estado del usuario en el servidor
6. Redirige al usuario a la página principal
7. La sesión se mantiene activa durante la conexión de Blazor Server

### 1. Carrito de Compras Mejorado
El carrito ahora funciona en todo momento:
- ✅ Puedes agregar productos sin iniciar sesión
- ✅ Solo se requiere login al momento de hacer el checkout
- ✅ Visualización en tiempo real del número de productos y total en la barra de navegación

### 2. Integración con WhatsApp
Después de completar un pedido:
- ✅ El sistema redirige automáticamente a WhatsApp (número **3003895839**)
- ✅ Envía un mensaje pre-formateado con todos los detalles del pedido:
  - ✅ Información del cliente
  - ✅ Listado de productos con nombres completos
  - ✅ Especificaciones personalizadas (RAM, SSD, garantías, etc.)
  - ✅ Cantidades de cada producto
  - ✅ Precios detallados y total del pedido
  - ✅ Fecha y hora del pedido

### 3. Robustez Técnica
La implementación garantiza que:
- ✅ Los nombres de productos y especificaciones siempre se cargan desde la base de datos
- ✅ Funciona correctamente incluso después de recargar la página
- ✅ Los totales se calculan con precisión sumando precio base + especificaciones × cantidad

### 4. Flujo de Compra Completo
El usuario experimenta el siguiente flujo:
1. Navega por el catálogo y agrega productos al carrito (con o sin login)
2. Personaliza productos con especificaciones adicionales
3. Va al checkout (debe iniciar sesión si no lo ha hecho)
4. Completa el formulario con sus datos
5. Al confirmar, el pedido se guarda en la base de datos
6. Automáticamente se abre WhatsApp con el mensaje completo del pedido listo para enviar al número **3003895839**

### Feature Specifications
- **Data Models**: `Usuario` (enhanced with AvatarUrl, Ciudad, Pais, ProductosFavoritos), `ProductoFavorito` (new model for wishlist), `ProductoTecnologico`, `Especificacion`, `Orden` (enhanced with Estado enum), `ItemOrden`, and `EspecificacionOrden` define the core entities and their relationships.
- **Data Layer**: `TechStoreContext` (Entity Framework Core with SQLite) manages database interactions with **persistent data** (no data deletion on restart) and includes seed data for products and specifications. `CarritoService` (scoped service) manages the enhanced shopping cart state with advanced functionalities. `UsuarioService` (scoped service) handles all authentication logic, including user registration, login, logout, profile updates, **wishlist management**, and **secure password changes with BCrypt**.
- **Security**: **BCrypt password hashing with workFactor 12**, form validation, SQL injection prevention via Entity Framework, and separation of concerns.

### System Design Choices
The application is built using ASP.NET Core 8.0 with Blazor Server-Side for the UI. SQLite is used as the database with Entity Framework Core 8.0. C# 12 is the primary programming language. The project structure is organized into `Components` (for UI elements and pages), `Data` (for database context and services), `Models` (for data entities), and `wwwroot` (for static assets). Data flow involves adding products to the `EstadoPedido` service, cloning cart items for persistence during checkout, and loading order history with all related entities using Entity Framework's `Include`/`ThenInclude`.

## External Dependencies
- **Framework**: ASP.NET Core 8.0
- **UI Framework**: Blazor Server-Side
- **Database**: SQLite (via Entity Framework Core 8.0) with **persistent data storage**
- **Programming Language**: C# 12 (.NET 8)
- **Security**: BCrypt.Net-Next 4.0.3 for password hashing
- **Images**: Unsplash
- **Fonts**: Google Fonts (Inter)

## Recent Major Updates (November 24, 2025)

### Complete Rebuild - Shopping Cart & User Profiles Enhancement

#### 1. Enhanced Data Models
- **Usuario Model**: Added `AvatarUrl`, `Ciudad`, `Pais` fields, and `ProductosFavoritos` navigation property for wishlist functionality
- **ProductoFavorito Model**: New model for persistent wishlist/favorites with user-product relationship tracking
- **Orden Model**: Enhanced with `Estado` enum (Pendiente, EnProceso, Enviado, Entregado, Cancelado) for better order tracking

#### 2. New CarritoService
- Replaced `EstadoPedido` with enhanced `CarritoService`
- Advanced cart management with improved state handling
- Better integration with checkout process
- Real-time cart updates and notifications

#### 3. Enhanced User Profiles
- **Avatar Support**: Users can now have profile pictures with default avatar fallback
- **Location Information**: Added city and country fields for better user data
- **Statistics Dashboard**: Shows total orders, completed orders, and favorite products count
- **Complete Order History**: Enhanced display with order status indicators and detailed product information
- **Wishlist Integration**: Direct access to favorite products from profile

#### 4. Wishlist/Favorites Functionality
- **Database Persistence**: Favorites are saved to database and persist across sessions
- **Toggle Functionality**: Easy add/remove from favorites with heart icon
- **Dedicated Favorites Page**: Complete view of all favorited products
- **Quick Access**: Favorites accessible from user menu in navigation

#### 5. New UI Components
- **CarritoFloating**: Floating cart widget in bottom-right corner with real-time item counter and total
- **Favoritos Page**: Dedicated page for viewing and managing favorite products
- **Enhanced Index**: Product catalog with search functionality and wishlist integration

#### 6. Improved Security
- **BCrypt Implementation**: Upgraded from SHA256 to BCrypt.Net-Next for password hashing
- **WorkFactor 12**: Enhanced security with higher iteration count
- **Proper Salt Generation**: BCrypt handles salt generation internally for better security
- **Secure Password Verification**: Using BCrypt.Verify for password validation

#### 7. Database Improvements
- **Persistent Data**: Removed `EnsureDeleted()` - database now persists between application restarts
- **Data Preservation**: Existing data is no longer deleted when application starts
- **Proper Initialization**: Using `EnsureCreated()` only for initial setup

#### 8. Complete CSS Redesign
- **Modern Gradient Design**: Professional gradients with cyan and purple accents
- **Smooth Animations**: Fade-in effects, hover transitions, and smooth interactions
- **Responsive Layout**: Optimized for all device sizes
- **Enhanced Visual Hierarchy**: Better use of shadows, borders, and spacing
- **Professional Polish**: Refined buttons, cards, and form elements

#### 9. Enhanced Pages
- **Index/Catalog**: Real-time search, category filters, wishlist integration, improved product cards
- **Checkout**: Better UX with quantity controls, improved validation, cleaner layout
- **Perfil**: Statistics dashboard, avatar display, complete order history, wishlist access
- **MisPedidos**: Order status indicators with icons, detailed product information
- **Favoritos**: New page for managing favorite products

### Technical Architecture Improvements
- **Better Separation of Concerns**: Services properly handle business logic
- **Enhanced State Management**: Improved cart and user state handling
- **Database Relationships**: Proper foreign keys and navigation properties
- **Modern UI/UX**: Professional design with attention to detail