@page "/register"
@inject UsuarioService UsuarioService
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Crear Cuenta - TechStore</PageTitle>

<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1>ðŸš€ Crear Cuenta</h1>
            <p>Ãšnete a TechStore hoy mismo</p>
        </div>

        @if (!string.IsNullOrEmpty(mensaje))
        {
            <div class="alert @(esError ? "alert-error" : "alert-success")">
                @mensaje
            </div>
        }

        <EditForm Model="@registro" OnValidSubmit="HandleRegistro">
            <DataAnnotationsValidator />

            <div class="form-group">
                <label>ðŸ‘¤ Nombre</label>
                <InputText @bind-Value="registro.Nombre" class="form-input" placeholder="Tu nombre" />
                <ValidationMessage For="@(() => registro.Nombre)" />
            </div>

            <div class="form-group">
                <label>ðŸ‘¤ Apellido</label>
                <InputText @bind-Value="registro.Apellido" class="form-input" placeholder="Tu apellido" />
                <ValidationMessage For="@(() => registro.Apellido)" />
            </div>

            <div class="form-group">
                <label>ðŸ“§ Email</label>
                <InputText @bind-Value="registro.Email" type="email" class="form-input" placeholder="tu@email.com" />
                <ValidationMessage For="@(() => registro.Email)" />
            </div>

            <div class="form-group">
                <label>ðŸ”’ ContraseÃ±a</label>
                <InputText @bind-Value="registro.ContraseÃ±a" type="password" class="form-input" placeholder="MÃ­nimo 6 caracteres" />
                <ValidationMessage For="@(() => registro.ContraseÃ±a)" />
            </div>

            <div class="form-group">
                <label>ðŸ”’ Confirmar ContraseÃ±a</label>
                <InputText @bind-Value="registro.ContraseÃ±aConfirm" type="password" class="form-input" placeholder="Repite tu contraseÃ±a" />
                <ValidationMessage For="@(() => registro.ContraseÃ±aConfirm)" />
            </div>

            <button type="submit" class="btn-login" disabled="@procesando">
                @if (procesando)
                {
                    <span>Creando cuenta...</span>
                }
                else
                {
                    <span>âœ“ Crear Cuenta</span>
                }
            </button>
        </EditForm>

        <div class="auth-footer">
            <p>Â¿Ya tienes cuenta? <a href="/login">Inicia sesiÃ³n â†’</a></p>
        </div>
    </div>
</div>

@code {
    private RegistroModel registro = new();
    private string mensaje = "";
    private bool esError = false;
    private bool procesando = false;

    private async Task HandleRegistro()
    {
        procesando = true;
        mensaje = "";

        var (Ã©xito, msg) = await UsuarioService.RegistrarAsync(
            registro.Email,
            registro.Nombre,
            registro.Apellido,
            registro.ContraseÃ±a,
            registro.ContraseÃ±aConfirm
        );

        if (Ã©xito)
        {
            mensaje = "Â¡Cuenta creada! Redirigiendo...";
            esError = false;
            await Task.Delay(500);
            NavigationManager.NavigateTo("/", forceLoad: true);
        }
        else
        {
            mensaje = msg;
            esError = true;
        }

        procesando = false;
    }

    public class RegistroModel
    {
        public string Nombre { get; set; } = "";
        public string Apellido { get; set; } = "";
        public string Email { get; set; } = "";
        public string ContraseÃ±a { get; set; } = "";
        public string ContraseÃ±aConfirm { get; set; } = "";
    }
}
