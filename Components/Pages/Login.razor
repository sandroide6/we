@page "/login"
@inject UsuarioService UsuarioService
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Iniciar SesiÃ³n - TechStore</PageTitle>

<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1>ğŸ” Iniciar SesiÃ³n</h1>
            <p>Bienvenido de vuelta a TechStore</p>
        </div>

        @if (!string.IsNullOrEmpty(mensaje))
        {
            <div class="alert @(esError ? "alert-error" : "alert-success")">
                @mensaje
            </div>
        }

        <EditForm Model="@login" OnValidSubmit="HandleLogin">
            <DataAnnotationsValidator />

            <div class="form-group">
                <label>ğŸ“§ Email</label>
                <InputText @bind-Value="login.Email" class="form-input" placeholder="tu@email.com" />
                <ValidationMessage For="@(() => login.Email)" />
            </div>

            <div class="form-group">
                <label>ğŸ”’ ContraseÃ±a</label>
                <InputText @bind-Value="login.ContraseÃ±a" type="password" class="form-input" placeholder="Tu contraseÃ±a" />
                <ValidationMessage For="@(() => login.ContraseÃ±a)" />
            </div>

            <button type="submit" class="btn-login" disabled="@procesando">
                @if (procesando)
                {
                    <span>Iniciando sesiÃ³n...</span>
                }
                else
                {
                    <span>âœ“ Iniciar SesiÃ³n</span>
                }
            </button>
        </EditForm>

        <div class="auth-footer">
            <p>Â¿No tienes cuenta? <a href="/register">Crea una aquÃ­ â†’</a></p>
        </div>
    </div>
</div>

@code {
    private LoginModel login = new();
    private string mensaje = "";
    private bool esError = false;
    private bool procesando = false;

    private async Task HandleLogin()
    {
        procesando = true;
        mensaje = "";

        var (Ã©xito, msg) = await UsuarioService.LoginAsync(login.Email, login.ContraseÃ±a);

        if (Ã©xito)
        {
            mensaje = "Â¡Bienvenido!";
            esError = false;
            await Task.Delay(1000);
            NavigationManager.NavigateTo("/");
        }
        else
        {
            mensaje = msg;
            esError = true;
        }

        procesando = false;
    }

    public class LoginModel
    {
        public string Email { get; set; } = "";
        public string ContraseÃ±a { get; set; } = "";
    }
}
